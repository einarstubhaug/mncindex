/*! mncindex 2016-03-20 */
function drawChart(a,b,c){$.jqplot(a,b,{axes:{xaxis:{renderer:$.jqplot.DateAxisRenderer,tickRenderer:$.jqplot.CanvasAxisTickRenderer,tickOptions:{formatString:"%b %#d",angle:-30,fontSize:"40px"},tickInterval:"5 day"},yaxis:{labelrenderer:$.jqplot.CanvasAxisLabelRenderer,label:c,labelOptions:{fontSize:"40px"},numberTicks:4}},highlighter:{show:!0,sizeAdjust:7.5},cursor:{show:!1}})}function convert_date_mysql_to_javascript(a){var b=a.split(/[- :]/);return new Date(b[0],b[1]-1,b[2],b[3],b[4],b[5])}var mncindex=angular.module("mncindex",[]);mncindex.service("dataFetcher",["$http","$timeout",function(a,b){var c=this;c.micronations=[],c.ref_currency="USD",c.updateData=function(){a.get("/api/micronations?ref_currency="+c.ref_currency).then(function(a){c.micronations=a.data.micronations,c.currencies=a.data.currencies})},c.updateData(),c.getMicronationData=function(a){return c.micronations.find(function(b,c){return b.m_iso_code===a?!0:void 0})},c.getHistoricValues=function(a,b,d){for(var e=[],f=c.currencies[a].currency_history,g=c.currencies[b].currency_history,h=0;h<f.length;h++)"USD"==b?e.push([f[h][0],f[h][1]*d]):g[h]&&f[h]&&e.push([f[h][0],g[h][1]/f[h][1]*d]);return e}}]),mncindex.controller("currencytable",["$scope","dataFetcher","$timeout",function(a,b,c){a.dataFetcher=b,a.showCountryInfo=function(a){var c=b.getMicronationData(a);$(".modal-title").html(c.nation_name);var d='<img src="/api/flag/'+c.m_iso_code+'">';d+="<div>1 "+c.currency_name+" = "+c.pegged_value+" "+c.c_iso_code+"</div>",d+='<div id="chart"></div>';var e=new Date(c.date_established);d+='<div class="established" >Established '+$.datepicker.formatDate("dd MM yy",e)+"</div>",d+='<div><a target="_blank" href="'+c.website_link+'">'+c.website_link+"</a></div>",$(".modal-body").html(d);var f="USD"==c.c_iso_code?"EUR":"USD",g=b.getHistoricValues(c.c_iso_code,f,c.pegged_value);$(".modal").modal("show"),setTimeout(function(){drawChart("chart",[g],f,"12px")},500)}}]);var showMarquee=function(a){$(".marquee").html(a).marquee({duration:3e4})};mncindex.controller("marquee",["$scope","dataFetcher",function(a,b){a.dataFetcher=b,a.$watch("dataFetcher.micronations",function(a){var c="";b.micronations.forEach(function(a){c=c+" "+a.m_iso_code+" = "+parseFloat(a.value_to_ref_currency).toFixed(3)+" / "}),showMarquee(c)})}]),mncindex.controller("currencycalculator",["$scope","dataFetcher",function(a,b){function c(a){if(console.log("finding for "+a),b.currencies[a])return b.currencies[a].value_to_dollar;for(var c=0;c<b.micronations.length;c++)if(a==b.micronations[c].m_iso_code)return b.micronations[c].value_to_dollar*b.micronations[c].pegged_value}a.dataFetcher=b,a.selectedFromValue="EUR",a.selectedToValue="USD",a.calculateCurrency=function(){if(!$("#from_value").val())return alert("Please provide amount..."),!1;var b=c(a.selectedFromValue),d=c(a.selectedToValue),e=b/d*$("#from_value").val();$("#to_value").val(e.toFixed(3))}}]);